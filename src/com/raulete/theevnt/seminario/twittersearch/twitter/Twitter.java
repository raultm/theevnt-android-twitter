package com.raulete.theevnt.seminario.twittersearch.twitter;

import java.net.URLEncoder;
import java.util.ArrayList;

import org.json.JSONArray;
import org.json.JSONObject;

import android.util.Log;

import com.raulete.theevnt.seminario.twittersearch.util.HttpUtil;

public class Twitter {
	
	/*
	 * If we don't have internet access in the TheEvnt classroom change to false
	 */
	final static public boolean internetConnection = true;
	
	/*
	 *  REST ACTIONS
	 *  https://dev.twitter.com/docs/api/1/get/search
	 */
	public static String TWITTER_SEARCH = "http://search.twitter.com/search.json?q=[query]";
	
	public static ArrayList<Tweet> getLastTweetsInSearch(String search){
		//URLEncoder.encode deprecated but useful to avoid problems with twitter.
		@SuppressWarnings("deprecation")
		String searchUrl = TWITTER_SEARCH.replace("[query]", URLEncoder.encode(search.trim()));
		//Log in the console the query to request.
		Log.i("TWITTER", searchUrl);
		String response = "";
		if(internetConnection){
			response = HttpUtil.httpGetRequest(searchUrl);
		} else {
			response = "{\"completed_in\":0.016,\"max_id\":301698780321955841,\"max_id_str\":\"301698780321955841\",\"next_page\":\"?page=2&max_id=301698780321955841&q=theevnt\",\"page\":1,\"query\":\"theevnt\",\"refresh_url\":\"?since_id=301698780321955841&q=theevnt\",\"results\":[{\"created_at\":\"Wed, 13 Feb 2013 14:26:09 +0000\",\"from_user\":\"jmbeas\",\"from_user_id\":17984862,\"from_user_id_str\":\"17984862\",\"from_user_name\":\"Jose Manuel Beas\",\"geo\":null,\"id\":301698780321955841,\"id_str\":\"301698780321955841\",\"iso_language_code\":\"es\",\"metadata\":{\"result_type\":\"recent\"},\"profile_image_url\":\"http://a0.twimg.com/profile_images/3201476192/60765f2175dc7d8ec7b2f8efdc2fa970_normal.png\",\"profile_image_url_https\":\"https://si0.twimg.com/profile_images/3201476192/60765f2175dc7d8ec7b2f8efdc2fa970_normal.png\",\"source\":\"&lt;a href=&quot;http://twicca.r246.jp/&quot;&gt;twicca&lt;/a&gt;\",\"text\":\"RT @theevnt: \u00a1Ya tenemos el 50% de las plazas ocupadas para el seminario de Android! \u00bfTe lo van a contar? http://t.co/kK1pCzd4 :)\",\"to_user\":null,\"to_user_id\":0,\"to_user_id_str\":\"0\",\"to_user_name\":null},{\"created_at\":\"Wed, 13 Feb 2013 14:14:22 +0000\",\"from_user\":\"raultm\",\"from_user_id\":91084007,\"from_user_id_str\":\"91084007\",\"from_user_name\":\"Raul Tierno\",\"geo\":null,\"id\":301695815443968001,\"id_str\":\"301695815443968001\",\"iso_language_code\":\"es\",\"metadata\":{\"result_type\":\"recent\"},\"profile_image_url\":\"http://a0.twimg.com/profile_images/534097885/ralph_normal.jpeg\",\"profile_image_url_https\":\"https://si0.twimg.com/profile_images/534097885/ralph_normal.jpeg\",\"source\":\"&lt;a href=&quot;http://twitter.com/&quot;&gt;web&lt;/a&gt;\",\"text\":\"@tharandur @theevnt Tas enterao que han estado por conciertos Radio3 no? Atento a la instantanea! http://t.co/9OqMqaSz\",\"to_user\":\"tharandur\",\"to_user_id\":8679742,\"to_user_id_str\":\"8679742\",\"to_user_name\":\"C\u00e9sar Su\u00e1rez\",\"in_reply_to_status_id\":301695024884756481,\"in_reply_to_status_id_str\":\"301695024884756481\"},{\"created_at\":\"Wed, 13 Feb 2013 14:11:13 +0000\",\"from_user\":\"tharandur\",\"from_user_id\":8679742,\"from_user_id_str\":\"8679742\",\"from_user_name\":\"C\u00e9sar Su\u00e1rez\",\"geo\":null,\"id\":301695024884756481,\"id_str\":\"301695024884756481\",\"iso_language_code\":\"sv\",\"metadata\":{\"result_type\":\"recent\"},\"profile_image_url\":\"http://a0.twimg.com/profile_images/1277204074/eightbit-54d05ac0-b08d-4d38-bce0-9b139135e457_normal.png\",\"profile_image_url_https\":\"https://si0.twimg.com/profile_images/1277204074/eightbit-54d05ac0-b08d-4d38-bce0-9b139135e457_normal.png\",\"source\":\"&lt;a href=&quot;http://twitter.com/download/android&quot;&gt;Twitter for Android&lt;/a&gt;\",\"text\":\"@raultm @theevnt Toundra en Madrid :D\",\"to_user\":\"raultm\",\"to_user_id\":91084007,\"to_user_id_str\":\"91084007\",\"to_user_name\":\"Raul Tierno\",\"in_reply_to_status_id\":301694754570240000,\"in_reply_to_status_id_str\":\"301694754570240000\"},{\"created_at\":\"Wed, 13 Feb 2013 14:10:09 +0000\",\"from_user\":\"raultm\",\"from_user_id\":91084007,\"from_user_id_str\":\"91084007\",\"from_user_name\":\"Raul Tierno\",\"geo\":null,\"id\":301694754570240000,\"id_str\":\"301694754570240000\",\"iso_language_code\":\"es\",\"metadata\":{\"result_type\":\"recent\"},\"profile_image_url\":\"http://a0.twimg.com/profile_images/534097885/ralph_normal.jpeg\",\"profile_image_url_https\":\"https://si0.twimg.com/profile_images/534097885/ralph_normal.jpeg\",\"source\":\"&lt;a href=&quot;http://twitter.com/&quot;&gt;web&lt;/a&gt;\",\"text\":\"@tharandur @theevnt tienes movidota ese finde?\",\"to_user\":\"tharandur\",\"to_user_id\":8679742,\"to_user_id_str\":\"8679742\",\"to_user_name\":\"C\u00e9sar Su\u00e1rez\",\"in_reply_to_status_id\":301618740305469440,\"in_reply_to_status_id_str\":\"301618740305469440\"},{\"created_at\":\"Wed, 13 Feb 2013 13:36:36 +0000\",\"from_user\":\"MiguelTrujilloS\",\"from_user_id\":298673893,\"from_user_id_str\":\"298673893\",\"from_user_name\":\"Miguel Trujillo\",\"geo\":null,\"id\":301686310823931904,\"id_str\":\"301686310823931904\",\"iso_language_code\":\"es\",\"metadata\":{\"result_type\":\"recent\"},\"profile_image_url\":\"http://a0.twimg.com/profile_images/2202779907/image_normal.jpg\",\"profile_image_url_https\":\"https://si0.twimg.com/profile_images/2202779907/image_normal.jpg\",\"source\":\"&lt;a href=&quot;http://twitter.com/download/android&quot;&gt;Twitter for Android&lt;/a&gt;\",\"text\":\"@theevnt apuntado a la lisa de espera, para una vez que no me llevo la tablet a clase...\",\"to_user\":\"theevnt\",\"to_user_id\":107522465,\"to_user_id_str\":\"107522465\",\"to_user_name\":\"The Evnt\",\"in_reply_to_status_id\":301663657920720896,\"in_reply_to_status_id_str\":\"301663657920720896\"},{\"created_at\":\"Wed, 13 Feb 2013 13:32:29 +0000\",\"from_user\":\"theevnt\",\"from_user_id\":107522465,\"from_user_id_str\":\"107522465\",\"from_user_name\":\"The Evnt\",\"geo\":null,\"id\":301685276143669248,\"id_str\":\"301685276143669248\",\"iso_language_code\":\"es\",\"metadata\":{\"result_type\":\"recent\"},\"profile_image_url\":\"http://a0.twimg.com/profile_images/2856615269/baed48a5786acbc0bde101044a89e1ab_normal.png\",\"profile_image_url_https\":\"https://si0.twimg.com/profile_images/2856615269/baed48a5786acbc0bde101044a89e1ab_normal.png\",\"source\":\"&lt;a href=&quot;http://www.tweetdeck.com&quot;&gt;TweetDeck&lt;/a&gt;\",\"text\":\"@JEnriqueMoguel disculpa, ya hemos arreglado el error. Pon un comentario y te meteremos en la lista de espera :)\",\"to_user\":\"JEnriqueMoguel\",\"to_user_id\":844129992,\"to_user_id_str\":\"844129992\",\"to_user_name\":\"Jos\u00e9 Enrique Moguel\",\"in_reply_to_status_id\":301681708351250434,\"in_reply_to_status_id_str\":\"301681708351250434\"},{\"created_at\":\"Wed, 13 Feb 2013 13:18:18 +0000\",\"from_user\":\"JEnriqueMoguel\",\"from_user_id\":844129992,\"from_user_id_str\":\"844129992\",\"from_user_name\":\"Jos\u00e9 Enrique Moguel\",\"geo\":null,\"id\":301681708351250434,\"id_str\":\"301681708351250434\",\"iso_language_code\":\"es\",\"metadata\":{\"result_type\":\"recent\"},\"profile_image_url\":\"http://a0.twimg.com/profile_images/2645880739/c8e106d8e81927c0fe6f05b05f303d4c_normal.jpeg\",\"profile_image_url_https\":\"https://si0.twimg.com/profile_images/2645880739/c8e106d8e81927c0fe6f05b05f303d4c_normal.jpeg\",\"source\":\"&lt;a href=&quot;http://twitter.com/&quot;&gt;web&lt;/a&gt;\",\"text\":\"@theevnt jod_r, me qued\u00e9 sin plaza... \u00bfcomo puede ser? No puedo comentar en el blog. \u00bfMe apunt\u00e1is a la lista de espera? Gracias\",\"to_user\":\"theevnt\",\"to_user_id\":107522465,\"to_user_id_str\":\"107522465\",\"to_user_name\":\"The Evnt\",\"in_reply_to_status_id\":301663657920720896,\"in_reply_to_status_id_str\":\"301663657920720896\"},{\"created_at\":\"Wed, 13 Feb 2013 12:11:51 +0000\",\"from_user\":\"AndroiDevCC\",\"from_user_id\":1144629438,\"from_user_id_str\":\"1144629438\",\"from_user_name\":\"AndroiDevCC\",\"geo\":null,\"id\":301664982985240576,\"id_str\":\"301664982985240576\",\"iso_language_code\":\"es\",\"metadata\":{\"result_type\":\"recent\"},\"profile_image_url\":\"http://a0.twimg.com/profile_images/3201259710/54176b92ff9f442966ac517b98ff7d87_normal.png\",\"profile_image_url_https\":\"https://si0.twimg.com/profile_images/3201259710/54176b92ff9f442966ac517b98ff7d87_normal.png\",\"source\":\"&lt;a href=&quot;http://itunes.apple.com/us/app/twitter/id409789998?mt=12&quot;&gt;Twitter for Mac&lt;/a&gt;\",\"text\":\"RT @theevnt: Sin plazas para el seminario de Android!, \u00bfTe quedaste sin plaza? Deja comentario en el blog para la lista de espera http://t.co/TKB8j0bx\",\"to_user\":null,\"to_user_id\":0,\"to_user_id_str\":\"0\",\"to_user_name\":null},{\"created_at\":\"Wed, 13 Feb 2013 12:11:45 +0000\",\"from_user\":\"kinisoftware\",\"from_user_id\":5202811,\"from_user_id_str\":\"5202811\",\"from_user_name\":\"Joaquin Engelmo\",\"geo\":null,\"id\":301664958914109441,\"id_str\":\"301664958914109441\",\"iso_language_code\":\"es\",\"metadata\":{\"result_type\":\"recent\"},\"profile_image_url\":\"http://a0.twimg.com/profile_images/2189274114/5b72ba8d-b166-4bcb-b102-ea65851a4393_normal.png\",\"profile_image_url_https\":\"https://si0.twimg.com/profile_images/2189274114/5b72ba8d-b166-4bcb-b102-ea65851a4393_normal.png\",\"source\":\"&lt;a href=&quot;http://itunes.apple.com/us/app/twitter/id409789998?mt=12&quot;&gt;Twitter for Mac&lt;/a&gt;\",\"text\":\"RT @theevnt: Sin plazas para el seminario de Android!, \u00bfTe quedaste sin plaza? Deja comentario en el blog para la lista de espera http://t.co/TKB8j0bx\",\"to_user\":null,\"to_user_id\":0,\"to_user_id_str\":\"0\",\"to_user_name\":null},{\"created_at\":\"Wed, 13 Feb 2013 12:11:19 +0000\",\"from_user\":\"victormpav\",\"from_user_id\":539204751,\"from_user_id_str\":\"539204751\",\"from_user_name\":\"V\u00edctor Pav\u00f3n\",\"geo\":null,\"id\":301664849316937728,\"id_str\":\"301664849316937728\",\"iso_language_code\":\"es\",\"metadata\":{\"result_type\":\"recent\"},\"profile_image_url\":\"http://a0.twimg.com/profile_images/2104947465/HjymywOPwA9K48G4AA_normal.jpg\",\"profile_image_url_https\":\"https://si0.twimg.com/profile_images/2104947465/HjymywOPwA9K48G4AA_normal.jpg\",\"source\":\"&lt;a href=&quot;http://hotot.org&quot;&gt;Hotot&lt;/a&gt;\",\"text\":\"@theevnt a ver si esta vez hay suerte y consegu\u00eds que se acaben las palmeras de chocolate como han volado las plazas para el seminario ;)\",\"to_user\":\"theevnt\",\"to_user_id\":107522465,\"to_user_id_str\":\"107522465\",\"to_user_name\":\"The Evnt\",\"in_reply_to_status_id\":301663657920720896,\"in_reply_to_status_id_str\":\"301663657920720896\"},{\"created_at\":\"Wed, 13 Feb 2013 12:09:34 +0000\",\"from_user\":\"RdeRonin\",\"from_user_id\":592754944,\"from_user_id_str\":\"592754944\",\"from_user_name\":\"Roberto L.\",\"geo\":null,\"id\":301664411033161728,\"id_str\":\"301664411033161728\",\"iso_language_code\":\"es\",\"metadata\":{\"result_type\":\"recent\"},\"profile_image_url\":\"http://a0.twimg.com/profile_images/2676246761/77fcdde1b3fc9c867cc7110491736e1d_normal.png\",\"profile_image_url_https\":\"https://si0.twimg.com/profile_images/2676246761/77fcdde1b3fc9c867cc7110491736e1d_normal.png\",\"source\":\"&lt;a href=&quot;http://twitter.com/download/android&quot;&gt;Twitter for Android&lt;/a&gt;\",\"text\":\"RT @theevnt: Sin plazas para el seminario de Android!, \u00bfTe quedaste sin plaza? Deja comentario en el blog para la lista de espera http://t.co/TKB8j0bx\",\"to_user\":null,\"to_user_id\":0,\"to_user_id_str\":\"0\",\"to_user_name\":null},{\"created_at\":\"Wed, 13 Feb 2013 12:09:04 +0000\",\"from_user\":\"josemi_fv\",\"from_user_id\":49803787,\"from_user_id_str\":\"49803787\",\"from_user_name\":\"J.M. Franco\",\"geo\":null,\"id\":301664282691645440,\"id_str\":\"301664282691645440\",\"iso_language_code\":\"es\",\"metadata\":{\"result_type\":\"recent\"},\"profile_image_url\":\"http://a0.twimg.com/profile_images/2788166341/7b026a37d2c452101e5d9916377ba305_normal.png\",\"profile_image_url_https\":\"https://si0.twimg.com/profile_images/2788166341/7b026a37d2c452101e5d9916377ba305_normal.png\",\"source\":\"&lt;a href=&quot;http://www.metrotwit.com/&quot;&gt;MetroTwit&lt;/a&gt;\",\"text\":\"RT @theevnt: Sin plazas para el seminario de Android!, \u00bfTe quedaste sin plaza? Deja comentario en el blog para la lista de espera http://t.co/TKB8j0bx\",\"to_user\":null,\"to_user_id\":0,\"to_user_id_str\":\"0\",\"to_user_name\":null},{\"created_at\":\"Wed, 13 Feb 2013 12:06:35 +0000\",\"from_user\":\"theevnt\",\"from_user_id\":107522465,\"from_user_id_str\":\"107522465\",\"from_user_name\":\"The Evnt\",\"geo\":null,\"id\":301663657920720896,\"id_str\":\"301663657920720896\",\"iso_language_code\":\"es\",\"metadata\":{\"result_type\":\"recent\"},\"profile_image_url\":\"http://a0.twimg.com/profile_images/2856615269/baed48a5786acbc0bde101044a89e1ab_normal.png\",\"profile_image_url_https\":\"https://si0.twimg.com/profile_images/2856615269/baed48a5786acbc0bde101044a89e1ab_normal.png\",\"source\":\"&lt;a href=&quot;http://www.tweetdeck.com&quot;&gt;TweetDeck&lt;/a&gt;\",\"text\":\"Sin plazas para el seminario de Android!, \u00bfTe quedaste sin plaza? Deja comentario en el blog para la lista de espera http://t.co/TKB8j0bx\",\"to_user\":null,\"to_user_id\":0,\"to_user_id_str\":\"0\",\"to_user_name\":null},{\"created_at\":\"Wed, 13 Feb 2013 11:41:14 +0000\",\"from_user\":\"elfraggel\",\"from_user_id\":2417401,\"from_user_id_str\":\"2417401\",\"from_user_name\":\"Mr. Green\",\"geo\":null,\"id\":301657279470645252,\"id_str\":\"301657279470645252\",\"iso_language_code\":\"es\",\"metadata\":{\"result_type\":\"recent\"},\"profile_image_url\":\"http://a0.twimg.com/profile_images/1898998623/mrgreen_normal.jpg\",\"profile_image_url_https\":\"https://si0.twimg.com/profile_images/1898998623/mrgreen_normal.jpg\",\"source\":\"&lt;a href=&quot;http://twitter.com/&quot;&gt;web&lt;/a&gt;\",\"text\":\"Tickets sacados para @theevent el sabado 23 con @raultm impartiendo su curso de humandroide! https://t.co/ukvOzLYC\",\"to_user\":null,\"to_user_id\":0,\"to_user_id_str\":\"0\",\"to_user_name\":null},{\"created_at\":\"Wed, 13 Feb 2013 11:25:00 +0000\",\"from_user\":\"josemi_fv\",\"from_user_id\":49803787,\"from_user_id_str\":\"49803787\",\"from_user_name\":\"J.M. Franco\",\"geo\":null,\"id\":301653193035767809,\"id_str\":\"301653193035767809\",\"iso_language_code\":\"es\",\"metadata\":{\"result_type\":\"recent\"},\"profile_image_url\":\"http://a0.twimg.com/profile_images/2788166341/7b026a37d2c452101e5d9916377ba305_normal.png\",\"profile_image_url_https\":\"https://si0.twimg.com/profile_images/2788166341/7b026a37d2c452101e5d9916377ba305_normal.png\",\"source\":\"&lt;a href=&quot;http://www.metrotwit.com/&quot;&gt;MetroTwit&lt;/a&gt;\",\"text\":\"@theevnt Espero que eso no signifique que tienes una mente cuadrada #festivaldelhumor\",\"to_user\":\"theevnt\",\"to_user_id\":107522465,\"to_user_id_str\":\"107522465\",\"to_user_name\":\"The Evnt\",\"in_reply_to_status_id\":301624411717529600,\"in_reply_to_status_id_str\":\"301624411717529600\"}],\"results_per_page\":15,\"since_id\":0,\"since_id_str\":\"0\"}";
		}
			
		ArrayList<Tweet> tweets = new ArrayList<Tweet>();
		try{
			JSONObject searchReponse = new JSONObject(response);
			JSONArray searchResults = searchReponse.getJSONArray("results");
			int searchResultsCount = searchResults.length();
			for(int index = 0; index < searchResultsCount; index++){
				tweets.add(new Tweet(searchResults.getJSONObject(index)));
			}
		} catch (Exception e){
			Log.i("TWITTER", "Error on parsing json String");
		}
		return tweets;
	}

}
